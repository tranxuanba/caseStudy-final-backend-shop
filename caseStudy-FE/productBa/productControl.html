<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <style>
        input[type=text] {
            width: 100%;
            padding: 12px 20px;
            margin: 8px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding: 3px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }
        table {
            table-layout: fixed;
            width: 100%;
            border-collapse: collapse;
            border: 3px solid purple;
        }
        h3{
            text-align: center;
            margin-bottom: 50px;
        }

    </style>

</head>
<body style="padding-top: 40px; background-color: #f2fcff" >
<h3>List Products</h3>
<form >
    <input type="text" id="search" name="search" placeholder="search">
    <input type="submit" value="Search" onclick="searchProduct()">
</form>
<input type="hidden" id="id">
<input id="name" placeholder="Name" >
<input id="price" placeholder="Price" >
<select id="cate"></select>
<input id="description" placeholder="Description">
<input type="date" id="datetime" placeholder="Datetime">
<input id="quantity" placeholder="Quantity">
<input id="number" placeholder="Sold Number">
<input id="image" placeholder="Image">
<input id="rate" placeholder="Rate" >
<select id="shop"></select>
<button onclick="create()">Create</button>
<button onclick="editProducts()">Edit</button>
<table class="table" id="products">
    <tr>
        <td scope="col">Id</td>
        <td scope="col"> Name</td>
        <td scope="col">Price</td>
        <td scope="col">Category</td>
        <td scope="col">Description</td>
        <td scope="col">Datetime</td>
        <td scope="col">Quantity</td>
        <td scope="col">Sold Number</td>
        <td scope="col">Image</td>
        <td scope="col">Rate</td>
        <td scope="col">Shop Name</td>
        <td scope="col">Delete</td>
        <td scope="col">Edit</td>
    </tr>
    <tbody id="tbody">
    <td><a></a></td>
    <td><a></a></td>
    </tbody>
</table>
<script>
    function choiceCate(){
        //1. lay du lieu tu phia backend
        $.ajax({
            //loai cua request: GET, POST, PUT, ....
            type: "GET",
            //duong dan cua API
            url: "http://localhost:8095/categorys",
            //xu ly luc thanh cong
            success: function (data) {
                console.log(data)
                let conten ="";
                for (let i = 0; i < data.length; i++) {
                    console.log(data[i].name)
                    conten+=`<option value="${data[i].id}">${data[i].name}</option>
                   `;
                }
                document.getElementById("cate").innerHTML = conten;
            }
        })
    }
    choiceCate();
    function choiceShop(){
        //1. lay du lieu tu phia backend
        $.ajax({
            //loai cua request: GET, POST, PUT, ....
            type: "GET",
            //duong dan cua API
            url: "http://localhost:8095/shops",
            //xu ly luc thanh cong
            success: function (data) {
                console.log(data)
                let conten ="";
                for (let i = 0; i < data.length; i++) {
                    console.log(data[i].name)
                    conten+=`<option value="${data[i].id}">${data[i].name}</option>
                   `;
                }
                document.getElementById("shop").innerHTML = conten;
            }
        })
    }
    choiceShop();
    function showAllProduct() {
        //1. lay du lieu tu phia backend
        $.ajax({
            //loai cua request: GET, POST, PUT, ....
            type: "GET",
            //duong dan cua API
            url: "http://localhost:8095/products",
            //xu ly luc thanh cong
            success: function (data) {
                console.log(data)
                //2. ve lai cai bang
                let content ="";
                for (let i = 0; i < data.length; i++) {
                    content+=`<tr><td>${data[i].id}</td>
        <td>${data[i].name}</td>
        <td>${data[i].price}</td>
        <td>${data[i].category.name}</td>
        <td>${data[i].description}</td>
        <td>${data[i].date_time}</td>
        <td>${data[i].quantity}</td>
        <td>${data[i].soldNumber}</td>
        <td>${data[i].image}</td>
        <td>${data[i].rate}</td>
        <td>${data[i].shop.name}</td>
        <td><a href="${data[i].id}" onclick="deleteProduct(this)">Delete</a></td>
        <td><a href="${data[i].id}" onclick="editProduct(this)">Edit</a></td></tr>`;
                }
                document.getElementById("tbody").innerHTML = content;

            }
        })
    }
    showAllProduct();

    function deleteProduct(element) {
        // lay id
        let id = element.getAttribute("href");
        //goi API phia backend
        $.ajax({
            headers:{
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "DELETE",
            url: "http://localhost:8095/products/"+ id,
            success: function (data){
                console.log("Xoa thanh cong id " + id);
                //xoa the
                // thay doi giao dien
                showAllProduct();
                // id.parent().parent().remove();
            }
        })
        //chan su kien mac dinh cua the
        event.preventDefault();
    }
    function create() {
        //lay ten
        let name = document.getElementById("name").value;
        let price = document.getElementById("price").value;
        let category = $('#cate').val();
        let description = document.getElementById("description");
        let date_time = document.getElementById("datetime");
        let quantity = document.getElementById("quantity");
        let soldnumber = document.getElementById("number");
        let image = document.getElementById("image");
        let rate = document.getElementById("rate");
        let shopname = $('#shop').val();
        //chuyen sang doi tuong
        let ob = {
            name: name,
            price: price,
            category: category,
            description: description,
            date_time: date_time,
            quantity: quantity,
            soldnumber: soldnumber,
            image: image,
            rate: rate,
            shopname: shopname
        }

        $.ajax({
            headers:{
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "POST",
            data: JSON.stringify(ob),
            url: "http://localhost:8095/products",
            success: function () {
                console.log("thanh cong")
                showAllProduct();
            }
        })
    }
    function editCategory(element){
        // lay id
        let id = element.getAttribute("href");
        console.log(id);

        //goi API phia backend
        $.ajax({
            type: "GET",
            url: "http://localhost:8095/categorys/"+ id,
            headers:{
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            success: function (data){
                console.log(data);
                console.log(id);
                $('#id').attr('value', `${data.id}`)
                $('#name').attr('value', `${data.name}`)
            }
        })
        //chan su kien mac dinh cua the
        event.preventDefault();
    }
    function editCategorys(){
        let id = $('#id').val();
        let name = $('#name').val();
        let category = {
            name: name
        }
        $.ajax({
            headers:{
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "PUT",
            url: "http://localhost:8095/categorys/"+ id,
            data:JSON.stringify(category),
            success: function (data){
                console.log(id);
                showAllCategory()
            }
        })
        event.preventDefault();
    }
    function getCategory(data) {
        return `<tr><td>${data.id}</td>
        <td>${data.name}</td>
        <td><a href="${data.id}" onclick="deleteCategory(this)">Delete</a></td>
        <td><a href="${data.id}" onclick="editCategory(this)">Edit</a></td></tr>`;
    }
    function searchCategory(){
        let search= $('#search').val();
        console.log(search)

        $.ajax({
            headers:{
                'Accept':'application/json',
                'Content-Type': 'application/json'
            },
            type:"GET",
            url: `http://localhost:8095/categorys/ba?search=${search}`,
            success:function (data){
                console.log(data)
                let str = '    <tr>\n' +
                    '        <td>ID</td>\n' +
                    '        <td>Name</td>\n' +
                    '    </tr>';

                for (let i = 0; i < data.content.length; i++) {
                    str += getCategory(data.content[i]);
                }
                document.getElementById('cate').innerHTML = str;
            }
        })

        event.preventDefault();
    }
</script>
</body>
</html>
